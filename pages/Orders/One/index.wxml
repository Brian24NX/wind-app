<!--pages/Orders/One/index.wxml-->
<wxs module="filters" src="../../../utils/format.wxs"></wxs>
<view class="searchResultContainers" wx:if="{{showSearch}}">
  <view class="searchResultContainer">
    <view class="resTitle">{{languageContent.title}}</view>
    <view class="resList others">
      <view class="oneRes">
        <image src="/assets/img/search/xianghao@2x.png" mode="aspectFit" class="resIcon"></image>
        <view class="resContent">{{detail.shipmentRef}}</view>
      </view>
      <view class="oneRes">
        <image src="/assets/img/search/daxiao@2x.png" mode="aspectFit" class="resIcon"></image>
        <view class="resContent">{{detail.size}}{{detail.type}}</view>
      </view>
    </view>
  </view>
</view>

<view class="oneOrderContainer" wx:if="{{stepList.length}}">
  <view class="timeContainer">
    <view class="times timeTop">
      <view class="left">{{languageContent.language === 'en' ? filters.formatEnDateLocal(stepList[stepList.length - 1].orginDate, '-', 'short') : filters.formatCnDateLocal(stepList[stepList.length - 1].orginDate)}}</view>
      <view class="right">{{timeRemaining}} {{languageContent.tian}}</view>
    </view>
    <view class="times timeBottom">
      <view class="left">
        <text>{{timeRemaining < 1 ? languageContent.tingbo : languageContent.yuji }}</text>
      </view>
      <view class="right">{{languageContent.shengyu}}</view>
    </view>
  </view>
  <view class="stepContainers">
    <view class="stepContainer">
      <view class="stepLine">
        <view class="stopDto dtoLeft"></view>
        <view class="stopDto dtoRight"></view>
        <view class="activedLine" style="width: {{(stepCount / stepList.length) * 100 + '%;'}};"></view>
        <image class="zhuizong" style="left: {{(stepCount / stepList.length) * 100 + '%;'}}" src="/assets/img/search/zhuizong@2x.png"></image>
      </view>
    </view>
    <view class="stepBottom">
      <view>{{stepList[0].transportCall.location.locationName}}{{stepList[0].carrierSpecificData.internalLocationCode ? ' (' + filters.setChina(stepList[0].carrierSpecificData.internalLocationCode, true, true) + ')' : ''}}</view>
      <view>{{stepList[stepList.length - 1].transportCall.location.locationName}}{{stepList[stepList.length - 1].carrierSpecificData.internalLocationCode ? ' (' + filters.setChina(stepList[stepList.length - 1].carrierSpecificData.internalLocationCode, true, true) + ')' : ''}}</view>
    </view>
  </view>
  <view class="stepLists">
    <view class="oneStep" wx:for="{{stepList}}" wx:key="index">
      <view class="leftLines">
        <view class="beingDtoBg" wx:if="{{item.stepStatus === 'being'}}"></view>
        <view class="leftLineDto {{item.stepStatus === 'past' ? 'pastDto' : item.stepStatus === 'being' ? 'beingDto' : ''}}"></view>
        <view class="leftLine {{item.stepStatus === 'past' ? 'past' : ''}}" wx:if="{{index !== stepList.length - 1}}"></view>
      </view>
      <view class="stepContent {{item.stepStatus === 'being' ? 'beingBg' : ''}}">
        <view class="stepSatus">{{item.statusLabel}}</view>
        <view class="stepTime">{{languageContent.language === 'en' ? filters.formatEnDateLocal(item.orginDate, '-', 'short') : filters.formatCnDateLocal(item.orginDate)}} <text style="color: #2D75FF;" catchtap="lookLocation" data-item="{{item}}">{{item.transportCall.location.locationName}}</text></view>
      </view>
    </view>
  </view>
  <view class="bottomContainer">
    <view class="downloadBtn" bindtap="reportToPDF">{{languageContent.export}}</view>
    <view class="toEmail" catchtap="sendReport">{{languageContent.toEmail}}</view>
  </view>
</view>
<view class="noStepOrderData" wx:if="{{!stepList.length && !isLoading}}">
  <image src="https://wind.cma-cgm.com/images/no.png"></image>
  <view>未找到或已经卸货或返回堆场</view>
</view>
<email path="{{path}}" wx:if="{{showEmail}}" bind:closeEmail="closeEmail" bind:sendEmails="sendEmails"></email>

<van-popup show="{{ show }}" bind:close="onClose">{{location}}</van-popup>